@startuml
!theme plain
skinparam shadowing false
skinparam linetype ortho
skinparam roundcorner 8

title Диаграмма последовательности: запрос прогноза и оповещение

actor Operator as Operator
participant Dashboard as Dashboard
participant "API Gateway" as APIGateway
participant "Stream Engine" as StreamEngine
participant "Analysis Service" as AnalysisService
participant "Forecasting Service" as ForecastingService
participant "Notification Service" as NotificationService
database MonitoringDB as MonitoringDB

Operator -> Dashboard : Запрос прогноза
Dashboard -> APIGateway : REST: запрос прогноза
APIGateway -> StreamEngine : REST: запрос свежих данных
StreamEngine -> MonitoringDB : SQL: чтение агрегатов
StreamEngine --> APIGateway : Очищенные агрегаты
APIGateway -> AnalysisService : Передача агрегатов
AnalysisService -> AnalysisService : Добавление аномалий/признаков
AnalysisService --> ForecastingService : Набор признаков
ForecastingService -> MonitoringDB : SQL/файлы: загрузка активной модели
ForecastingService --> APIGateway : Прогноз + уровень риска
APIGateway -> NotificationService : REST: оценка уведомления
NotificationService -> NotificationService : Лог доставки
NotificationService --> Dashboard : WebSocket: обновление
NotificationService --> Operator : Push/SMS/e-mail уведомление
APIGateway --> Dashboard : Результат прогноза
Dashboard --> Operator : Итоговый прогноз и статус оповещений

@enduml

